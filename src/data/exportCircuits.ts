import type { ExportCircuit } from '@/types/circuits';

export const exportCircuits: ExportCircuit[] = [
  {
    id: 'fca_client_place',
    name: 'FCA - Livraison au transporteur client',
    shortName: 'FCA Client',
    description:
      "Fournisseur met la marchandise à disposition du transporteur du client, dédouanée export. Le client gère transport principal et import.",
    zone: 'MULTI',
    incoterms: ['FCA'],
    defaultIncoterm: 'FCA',
    transitaires: ['Client'],
    billing: {
      transitFeeKeywords: ['transit', 'frais dossier'],
      transitFeeSkuCodes: [],
      expectedCoveredCostTypes: ['MAIN_TRANSPORT', 'EXPORT_CUSTOMS'],
    },
    documentDistribution: [
      { document: 'Facture commerciale', recipients: ['Client'], notes: 'Original pour transporteur client' },
      { document: 'Packing list', recipients: ['Client'], notes: 'Copie pour contrôle' },
      { document: 'Bon de livraison', recipients: ['Client'], notes: 'Signé à la mise à disposition' },
      { document: 'Déclaration export (EX1)', recipients: ['Client'], notes: 'Copie pour preuve export' },
    ],
    declarationsRequired: ['Déclaration export (EX1)', 'DEB si destination UE'],
    documentsRequired: [
      'Facture commerciale',
      'Packing list',
      'Bon de livraison',
      'Preuve de mise à disposition au transporteur',
    ],
    costItems: [
      { id: 'prep', label: 'Préparation commande', payer: 'SELLER', costType: 'PREP', description: 'Emballage, étiquetage, palettisation' },
      { id: 'customs_export', label: 'Déclaration export', payer: 'SELLER', costType: 'EXPORT_CUSTOMS', description: 'Formalités douanières sortie FR' },
      { id: 'transport', label: 'Transport principal', payer: 'BUYER', costType: 'MAIN_TRANSPORT', description: 'Acheminement principal' },
      { id: 'customs_import', label: 'Import destination', payer: 'BUYER', costType: 'IMPORT_CUSTOMS', description: 'Douane entrée si Hors UE' },
      { id: 'duties', label: 'Droits/Taxes import', payer: 'BUYER', costType: 'DUTIES', description: "Droits, taxes à l'import (TVA/OM/OMR si applicables)" },
    ],
    steps: [
      { id: '1', label: 'Commande client', actor: 'Client', description: 'Réception et validation' },
      { id: '2', label: 'Préparation', actor: 'ORLIMAN', description: 'Préparation et emballage' },
      { id: '3', label: 'Déclaration export', actor: 'ORLIMAN', description: 'Formalités export (EX1)' },
      { id: '4', label: 'Mise à disposition', actor: 'ORLIMAN', description: 'Remise au transporteur client' },
      { id: '5', label: 'Transport', actor: 'Transporteur client', description: 'Acheminement' },
      { id: '6', label: 'Import', actor: 'Client', description: 'Formalités et livraison finale' },
    ],
    risks: ['Transport client non confirmé', 'Preuve d’export manquante', 'Pas de visibilité sur coûts import'],
    bestPractices: ['Coordonnées transporteur client avant expédition', 'Obtenir BL/CMR signé comme preuve', 'Partager copie EX1 au client'],
  },
  {
    id: 'ddp_direct',
    name: 'DDP Direct',
    shortName: 'DDP Direct',
    description:
      'Fournisseur prend en charge transport + import (droits/taxes) jusqu’à livraison finale. Fort besoin de maîtrise transit/douane.',
    zone: 'MULTI',
    incoterms: ['DDP'],
    defaultIncoterm: 'DDP',
    transitaires: ['DHL', 'Geodis', 'LVoverseas'],
    billing: {
      transitFeeKeywords: ['transit', 'frais dossier', 'clearance'],
      transitFeeSkuCodes: [],
      expectedCoveredCostTypes: ['MAIN_TRANSPORT', 'IMPORT_CUSTOMS', 'DUTIES', 'TAXES'],
    },
    vatRules: {
      context: 'DDP direct metropole vers client (UE / Hors UE / DROM)',
      importerOfRecord: 'Transitaire mandaté au nom du vendeur (IOR) ; vérifier qui figure sur le DAU/IM4.',
      payerImportVat: 'Vendeur (DDP) avance TVA import et taxes locales via transitaire.',
      payerDuties: 'Vendeur (DDP) paie droits/OM/OMR ; refacturation contractuelle possible.',
      taxRecovery:
        'TVA import récupérable si vendeur FR assujetti + DAU à son nom + facture transitaire ; OM/OMR non récupérables.',
      autoliquidation:
        "DROM : pas d'autoliquidation, TVA payée à l'import. Hors UE : autoliquidation possible si AI2/1695 II (à valider).",
      traceability: 'Conserver DAU/IM4 au nom du vendeur, quittances TVA/OM, preuve livraison, rapprochement facture client.',
      checks: [
        'Confirmer IOR (nom/adresse) sur DAU/IM4',
        'Mandat écrit DDP avec transitaire',
        'Aligner incoterm DDP avec conditions de facturation (TVA incluse ?)',
        'Exiger copie quittances TVA/OM/OMR et ventilation des frais',
      ],
      warnings: [
        'Risque trésorerie si transitaires facturent tardivement',
        'DDP peut impliquer obligations fiscales locales : valider avec fiscal/douane',
      ],
    },
    documentDistribution: [
      { document: 'Facture commerciale', recipients: ['DHL', 'Geodis', 'LVoverseas'], notes: '3 exemplaires' },
      { document: 'Packing list', recipients: ['DHL', 'Geodis', 'LVoverseas'], notes: 'Détail des colis' },
      { document: 'Document transport (CMR/AWB/BL)', recipients: ['DHL', 'Geodis', 'LVoverseas'] },
      { document: 'DAU', recipients: ['DHL', 'Geodis', 'LVoverseas'], notes: 'Si hors UE/DROM' },
      { document: 'Certificat origine', recipients: ['DHL', 'Geodis', 'LVoverseas'], notes: 'Si applicable' },
    ],
    declarationsRequired: ['Déclaration export (EX1)', 'DEB si UE', 'Déclaration import pays destination'],
    documentsRequired: [
      'Facture commerciale',
      'Packing list',
      'CMR/AWB/BL',
      'DAU si hors UE/DROM',
      'Certificat origine si applicable',
    ],
    costItems: [
      { id: 'prep', label: 'Préparation', payer: 'SELLER', costType: 'PREP', description: 'Emballage, étiquetage' },
      { id: 'customs_export', label: 'Douane export', payer: 'SELLER', costType: 'EXPORT_CUSTOMS', description: 'Formalités EX1' },
      { id: 'transport', label: 'Transport principal', payer: 'SELLER', costType: 'MAIN_TRANSPORT', description: 'Acheminement principal', typicalPct: { min: 3, max: 8, basis: 'value' } },
      { id: 'import_customs', label: 'Douane import', payer: 'SELLER', costType: 'IMPORT_CUSTOMS', description: 'Clearance import' },
      { id: 'duties', label: 'Droits', payer: 'SELLER', costType: 'DUTIES', description: 'Droits import' },
      { id: 'taxes', label: 'Taxes import', payer: 'SELLER', costType: 'TAXES', description: 'TVA/OM/OMR selon destination' },
    ],
    steps: [
      { id: '1', label: 'Commande client', actor: 'Client', description: 'Commande validée' },
      { id: '2', label: 'Préparation', actor: 'ORLIMAN', description: 'Prépa + documents' },
      { id: '3', label: 'Export', actor: 'ORLIMAN', description: 'EX1' },
      { id: '4', label: 'Transport', actor: 'Transitaire', description: 'Acheminement' },
      { id: '5', label: 'Import', actor: 'Transitaire', description: 'Clearance + paiement droits/taxes' },
      { id: '6', label: 'Livraison finale', actor: 'Transporteur', description: 'Chez client' },
    ],
    risks: ['Avance de trésorerie taxes import', 'Variabilité coûts douane', 'Blocage si documents incomplets'],
    bestPractices: ['Simuler coûts douane avant offre', 'Fixer plafonds de refacturation transit/douane', 'Transitaire fiable sur la destination'],
  },
  {
    id: 'platform_drom',
    name: 'DROM via Plateforme',
    shortName: 'Plateforme DROM',
    description:
      'Flux DROM avec plateforme logistique locale (ex TDIS). La plateforme gère import et distribution locale.',
    zone: 'DROM',
    incoterms: ['DAP', 'DDP'],
    defaultIncoterm: 'DAP',
    transitaires: ['LVoverseas', 'TDIS'],
    billing: {
      transitFeeKeywords: ['plateforme', 'transit', 'frais dossier'],
      transitFeeSkuCodes: [],
      expectedCoveredCostTypes: ['MAIN_TRANSPORT', 'PLATFORM_FEE', 'IMPORT_CUSTOMS', 'DUTIES', 'TAXES'],
    },
    vatRules: {
      context: 'DROM en DDP via plateforme locale',
      importerOfRecord:
        'Plateforme/transitaire local (ex TDIS) désigné comme IOR ; vérifier le mandat et le nom sur le DAU DROM.',
      payerImportVat: 'Vendeur (DDP) via transitaire/plateforme ; TVA DROM payée à l’import (pas d’autoliquidation).',
      payerDuties: 'Vendeur prend OM/OMR et droits éventuels ; refacturation possible selon contrat.',
      taxRecovery:
        'TVA DROM récupérable par vendeur assujetti si DAU/IM4 à son nom + facture douane ; OM/OMR non récupérables.',
      autoliquidation: "Non applicable pour DROM : TVA payée à l'import, conserver quittances.",
      traceability:
        'Collecter DAU/IM4 au nom du vendeur, quittances TVA/OM/OMR, preuve livraison plateforme, rapprochement factures.',
      checks: [
        'Confirmer IOR sur DAU/IM4 (plateforme ou vendeur)',
        'Mandat écrit plateforme/transitaire pour DDP',
        'Demander ventilation TVA/OM/OMR + frais plateforme',
        'S’assurer des justificatifs pour récupérer la TVA DROM',
      ],
      warnings: [
        'Délais et coûts OM/OMR variables selon produit',
        'Absence de justificatifs = TVA non récupérable',
      ],
    },
    documentDistribution: [
      { document: 'Facture commerciale', recipients: ['LVoverseas', 'TDIS'], notes: 'Export + plateforme' },
      { document: 'Packing list', recipients: ['LVoverseas', 'TDIS'] },
      { document: 'Connaissement (BL)', recipients: ['LVoverseas'] },
      { document: 'DAU', recipients: ['TDIS'], notes: 'Pour import DROM' },
      { document: 'Fiche plateforme', recipients: ['TDIS'], notes: 'Instructions de distribution' },
    ],
    declarationsRequired: ['Déclaration export (EX1)', 'DAU', 'Déclaration OM/OMR (taux via référentiel destination)'],
    documentsRequired: ['Facture', 'Packing list', 'BL maritime', 'DAU', 'Fiche plateforme'],
    costItems: [
      { id: 'prep', label: 'Préparation export', payer: 'SELLER', costType: 'PREP', description: 'Emballage maritime' },
      { id: 'export_customs', label: 'Douane export FR', payer: 'SELLER', costType: 'EXPORT_CUSTOMS', description: 'EX1' },
      { id: 'transport_maritime', label: 'Transport maritime', payer: 'SELLER', costType: 'MAIN_TRANSPORT', description: 'Fret maritime', typicalPct: { min: 4, max: 7, basis: 'value' } },
      { id: 'handling_port', label: 'Manutention portuaire', payer: 'SELLER', costType: 'HANDLING', description: 'Déchargement + quai' },
      { id: 'platform_fee', label: 'Frais plateforme', payer: 'SELLER', costType: 'PLATFORM_FEE', description: 'Stockage + préparation + distribution', typicalPct: { min: 2, max: 4, basis: 'value' } },
      { id: 'import_customs', label: 'Douane import DROM', payer: 'VARIABLE', payerDependsOn: 'incoterm', costType: 'IMPORT_CUSTOMS', description: 'Selon incoterm DAP/DDP' },
      { id: 'duties', label: 'OM/OMR', payer: 'VARIABLE', payerDependsOn: 'incoterm', costType: 'DUTIES', description: 'Taux selon nomenclature, voir référentiel destination' },
      { id: 'taxes', label: 'TVA DROM', payer: 'VARIABLE', payerDependsOn: 'incoterm', costType: 'TAXES', description: 'Selon référentiel destination' },
    ],
    steps: [
      { id: '1', label: 'Commande client', actor: 'Client DROM', description: 'Commande validée' },
      { id: '2', label: 'Préparation export', actor: 'ORLIMAN', description: 'Conditionnement' },
      { id: '3', label: 'Export France', actor: 'ORLIMAN + LVoverseas', description: 'EX1 + mise FOB' },
      { id: '4', label: 'Transport maritime', actor: 'LVoverseas', description: '15-25 jours' },
      { id: '5', label: 'Plateforme locale', actor: 'TDIS', description: 'Stockage + préparation' },
      { id: '6', label: 'Douane import', actor: 'TDIS', description: 'OM/OMR + TVA selon référentiel' },
      { id: '7', label: 'Distribution locale', actor: 'TDIS', description: 'Livraison client final' },
    ],
    risks: ['Délais maritimes variables', 'OM/OMR complexes', 'Stockage plateforme si retard'],
    bestPractices: [
      'Contrat cadre avec plateforme',
      'Anticiper pics saisonniers',
      'Vérifier exonérations OM/OMR par produit',
    ],
  },
  {
    id: 'ue_intra',
    name: 'Flux Intracommunautaire UE',
    shortName: 'Intra-UE',
    description:
      "Échanges intra-UE : pas de douane mais obligations déclaratives (DEB/DES). TVA intracommunautaire via autoliquidation si TVA valide.",
    zone: 'UE',
    incoterms: ['DAP', 'FCA'],
    defaultIncoterm: 'DAP',
    transitaires: ['Geodis', 'DHL'],
    billing: {
      transitFeeKeywords: ['transit', 'frais dossier'],
      transitFeeSkuCodes: [],
      expectedCoveredCostTypes: ['MAIN_TRANSPORT'],
    },
    documentDistribution: [
      { document: 'Facture commerciale HT', recipients: ['Geodis', 'DHL'], notes: 'Mentions TVA intra obligatoires' },
      { document: 'Packing list', recipients: ['Geodis', 'DHL'] },
      { document: 'CMR / Lettre de voiture', recipients: ['Geodis'] },
      { document: 'AWB', recipients: ['DHL'] },
      { document: 'Preuve de livraison', recipients: ['Geodis', 'DHL'], notes: 'Conserver 6 ans' },
    ],
    declarationsRequired: ['DEB si seuil', 'DES si services', 'Listing TVA', 'Contrôle VIES TVA client'],
    documentsRequired: ['Facture HT', 'Packing list', 'Document transport', 'Preuve livraison', 'TVA intra client'],
    costItems: [
      { id: 'prep', label: 'Préparation', payer: 'SELLER', costType: 'PREP', description: 'Emballage standard' },
      { id: 'transport', label: 'Transport routier', payer: 'VARIABLE', payerDependsOn: 'incoterm', costType: 'MAIN_TRANSPORT', description: 'Selon incoterm (FCA/DAP)', typicalPct: { min: 2, max: 5, basis: 'value' } },
      { id: 'admin', label: 'Frais admin (DEB/TVA)', payer: 'SELLER', costType: 'ADMIN', description: 'DEB, contrôles TVA' },
    ],
    steps: [
      { id: '1', label: 'Commande UE', actor: 'Client', description: 'Numéro TVA requis' },
      { id: '2', label: 'Vérification TVA', actor: 'ORLIMAN', description: 'Contrôle VIES' },
      { id: '3', label: 'Facturation HT', actor: 'ORLIMAN', description: 'Mentions exonération' },
      { id: '4', label: 'Préparation', actor: 'ORLIMAN', description: 'Docs + emballage' },
      { id: '5', label: 'Transport', actor: 'Geodis/DHL', description: 'Livraison UE' },
      { id: '6', label: 'DEB mensuelle', actor: 'ORLIMAN', description: 'Si seuil > 460k€' },
      { id: '7', label: 'Réception', actor: 'Client', description: 'Autoliquidation TVA' },
    ],
    risks: ['TVA client invalide', 'Absence preuve transport', 'Oubli DEB'],
    bestPractices: ['Contrôle TVA systématique', 'Conserver CMR signé', 'Automatiser DEB'],
  },
  {
    id: 'suisse',
    name: 'Flux Suisse',
    shortName: 'Suisse',
    description:
      'Export hors UE vers Suisse. Nécessite EX1 + import suisse. EUR.1 recommandé pour réduire les droits.',
    zone: 'HORS_UE',
    incoterms: ['DAP', 'DDP'],
    defaultIncoterm: 'DAP',
    transitaires: ['Geodis', 'DHL', 'Autre'],
    billing: {
      transitFeeKeywords: ['transit', 'clearance'],
      transitFeeSkuCodes: [],
      expectedCoveredCostTypes: ['MAIN_TRANSPORT', 'IMPORT_CUSTOMS', 'DUTIES', 'TAXES'],
    },
    documentDistribution: [
      { document: 'Facture commerciale (FR/DE)', recipients: ['Geodis', 'DHL'] },
      { document: 'Packing list', recipients: ['Geodis', 'DHL'] },
      { document: 'EUR.1', recipients: ['Geodis', 'DHL'], notes: 'Pour préférence tarifaire' },
      { document: 'CMR', recipients: ['Geodis'] },
      { document: 'AWB', recipients: ['DHL'] },
      { document: 'e-dec Suisse', recipients: ['Autre'], notes: 'Transitaire import' },
    ],
    declarationsRequired: ['EX1', 'EUR.1 ou déclaration origine', 'Déclaration import CH (e-dec)'],
    documentsRequired: ['Facture FR/DE', 'Packing list', 'EUR.1', 'CMR/AWB', 'Certificat conformité si requis'],
    costItems: [
      { id: 'prep', label: 'Préparation', payer: 'SELLER', costType: 'PREP', description: 'Emballage, docs multilingues' },
      { id: 'customs_export', label: 'Douane export FR', payer: 'SELLER', costType: 'EXPORT_CUSTOMS', description: 'EX1 + EUR.1' },
      { id: 'transport', label: 'Transport routier', payer: 'VARIABLE', payerDependsOn: 'incoterm', costType: 'MAIN_TRANSPORT', description: 'France -> Suisse', typicalPct: { min: 2, max: 4, basis: 'value' } },
      { id: 'customs_import', label: 'Douane import CH', payer: 'VARIABLE', payerDependsOn: 'incoterm', costType: 'IMPORT_CUSTOMS', description: 'Formalités e-dec' },
      { id: 'duties', label: 'Droits', payer: 'VARIABLE', payerDependsOn: 'incoterm', costType: 'DUTIES', description: 'Selon tarif; 0% avec EUR.1' },
      { id: 'taxes', label: 'TVA suisse', payer: 'VARIABLE', payerDependsOn: 'incoterm', costType: 'TAXES', description: 'Taux selon réglementation suisse' },
    ],
    steps: [
      { id: '1', label: 'Commande CH', actor: 'Client', description: 'Commande Suisse' },
      { id: '2', label: 'Préparation', actor: 'ORLIMAN', description: 'Docs FR/DE, EUR.1' },
      { id: '3', label: 'Export France', actor: 'ORLIMAN', description: 'EX1 + EUR.1' },
      { id: '4', label: 'Transport', actor: 'Geodis/DHL', description: 'Passage frontière' },
      { id: '5', label: 'Import CH', actor: 'Transitaire CH', description: 'e-dec + taxes' },
      { id: '6', label: 'Livraison', actor: 'Transporteur', description: 'Client final' },
    ],
    risks: ['EUR.1 obligatoire pour franchise droits', 'TVA suisse non récupérable pour vendeur FR'],
    bestPractices: ['Toujours établir EUR.1', 'Transitaire suisse habitué dispositifs médicaux'],
  },
  {
    id: 'hors_ue',
    name: 'Flux Hors UE',
    shortName: 'Hors UE',
    description:
      "Export pays tiers. Possibles préférences tarifaires (EUR.1, FORM A). Douane export + import requis.",
    zone: 'HORS_UE',
    incoterms: ['FCA', 'DAP', 'DDP'],
    defaultIncoterm: 'FCA',
    transitaires: ['DHL', 'LVoverseas', 'Geodis', 'Autre'],
    billing: {
      transitFeeKeywords: ['transit', 'clearance', 'brokerage'],
      transitFeeSkuCodes: [],
      expectedCoveredCostTypes: ['MAIN_TRANSPORT', 'IMPORT_CUSTOMS', 'DUTIES', 'TAXES'],
    },
    documentDistribution: [
      { document: 'Facture commerciale (EN)', recipients: ['DHL', 'LVoverseas', 'Geodis', 'Autre'] },
      { document: 'Packing list', recipients: ['DHL', 'LVoverseas', 'Geodis', 'Autre'] },
      { document: 'EUR.1 / FORM A / ATR', recipients: ['DHL', 'LVoverseas', 'Geodis', 'Autre'], notes: 'Selon accord' },
      { document: "Certificat d'origine", recipients: ['DHL', 'LVoverseas', 'Geodis', 'Autre'] },
      { document: 'Document transport (BL/AWB/CMR)', recipients: ['DHL', 'LVoverseas', 'Geodis'] },
      { document: 'Certificats produits', recipients: ['Autre'], notes: 'Selon destination' },
    ],
    declarationsRequired: ['EX1', 'Documents préférence (EUR.1/FORM A)', 'Déclaration import pays destination'],
    documentsRequired: [
      'Facture EN',
      'Packing list',
      'Documents préférence (EUR.1/FORM A/ATR) si éligible',
      "Certificat d'origine",
      'Document transport',
      'Certificats spécifiques si requis',
    ],
    costItems: [
      { id: 'prep', label: 'Préparation export', payer: 'SELLER', costType: 'PREP', description: 'Emballage international' },
      { id: 'customs_export', label: 'Douane export', payer: 'SELLER', costType: 'EXPORT_CUSTOMS', description: 'EX1 + certificats' },
      { id: 'transport', label: 'Transport international', payer: 'VARIABLE', payerDependsOn: 'incoterm', costType: 'MAIN_TRANSPORT', description: 'Maritime/Aérien/Routier', typicalPct: { min: 5, max: 15, basis: 'value' } },
      { id: 'insurance', label: 'Assurance', payer: 'VARIABLE', payerDependsOn: 'incoterm', costType: 'INSURANCE', description: 'CIF si inclus', typicalPct: { min: 0.3, max: 0.5, basis: 'value' } },
      { id: 'customs_import', label: 'Douane import', payer: 'VARIABLE', payerDependsOn: 'incoterm', costType: 'IMPORT_CUSTOMS', description: 'Selon incoterm' },
      { id: 'duties', label: 'Droits', payer: 'VARIABLE', payerDependsOn: 'incoterm', costType: 'DUTIES', description: 'Selon pays et accord' },
      { id: 'taxes', label: 'Taxes import', payer: 'VARIABLE', payerDependsOn: 'incoterm', costType: 'TAXES', description: 'Taux selon réglementation locale' },
    ],
    steps: [
      { id: '1', label: 'Commande export', actor: 'Client', description: 'Commande internationale' },
      { id: '2', label: 'Vérification', actor: 'ORLIMAN', description: 'Sanctions, certificats' },
      { id: '3', label: 'Préparation', actor: 'ORLIMAN', description: 'Docs, emballage' },
      { id: '4', label: 'Export France', actor: 'ORLIMAN', description: 'EX1 + préférences' },
      { id: '5', label: 'Transport', actor: 'Transitaire', description: 'Acheminement' },
      { id: '6', label: 'Import destination', actor: 'Transitaire local', description: 'Douane + taxes' },
      { id: '7', label: 'Livraison', actor: 'Transporteur local', description: 'Distribution finale' },
    ],
    risks: ['Sanctions/embargos', 'Préférences mal établies', 'Délai import imprévisible'],
    bestPractices: [
      'Vérifier accords préférentiels',
      'Contrôler sanctions avant prise de commande',
      'Transitaire expérimenté sur destination',
      'Prévoir délais pour pays complexes',
    ],
  },
];

export const getCircuitById = (id: string): ExportCircuit | undefined => {
  return exportCircuits.find((c) => c.id === id);
};
